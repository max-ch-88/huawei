Configuration tasks:
1.AR-HUB-CE1 and AR-HUB-CE1 are hub CEs in MPLS VPN, and AR-HUB-PE1 and AR-HUB-PE2 are hub PEs. 
AR-SPOKE-CE3 and AR-SPOKE-CE4 are spoke CEs in MPLS VPN and AR-SPOKE-PE3 and AR-SPOKE-PE4 are spoke PEs.


2. Set parameters for VPN properly so that the traffic between 
spoke devices (CE3 and CE4) must pass through the hub CEs. 


3. Configure CE1 to establish direct EBGP peer relationships with PE1 through GE0/0/1 and GE0/0/2. 
CE1 advertise the routes of Spoke sites back to PE1 through GE0/0/2. 
On CE1, import OSPF routes (loopbacks0 interfaces CE1 and CE2 and 
also LAN network between CE1 and CE2 (192.168.12.0/24)) to BGP. 


4. Configure CE2 to establish direct EBGP peer relationships with PE2 through GE0/0/1 and GE0/0/2. 
CE2 advertise the routes of Spoke sites back to PE2 through GE0/0/2. 
On CE2, import OSPF routes (loopbacks0 interfaces CE1 and CE2 and 
also LAN network between CE1 and CE2 (192.168.12.0/24)) to BGP.
 

5. Configure CE3 to connect to PE3 through OSPF area 0 and 
advertise IP addresses of loopback interfaces on CE3 to OSPF. 

6.Configure CE4 to connect to PE4 through OSPF area 0 and 
advertise IP addresses of loopback interfaces  on CE4 to OSPF. 
-------------------
7. Configure ISIS as backbone IGP in AS100.
Configure PEs routers in AS 100  establish MP-IBGP IPv4 peer relationships with AR5-RR. 
Use the IP addresses of loopback0 interface  for neighbor relationship.


9. Configure MPLS LSR ID  for each NE in AS 100  and  MPLS LDP must be enabled globally. 
Establish LDP peer relationships between directly connected NEs in AS 100.
-------------------------

10. On CE1 and CE2, import BGP routes to OSPF. 
The configuration should have the best scalability to solve issue caused
 by dual-node bi-directional route importing.

--------------------------
11. CE2, CE3 and CE4 must learn default route generated by CE1. 



-----------------------------------------------
Optional tasks:
1.Adjust RT attributes of PE1, if the link between CE1 and PE1 is disconnected, 
PE1 can still learn the route to CE1.

2.Configure CE4 as a multi-VPN-instance edge (MCE).

3. Configure a static default route on CE1 to access the ISP device, with next-hop IP address as 195.1.1.1. 
The static default route should be bound to the BFD session between CE1 and the ISP
device (the ISP device does not support BFD). The fault detection time should be not more than 140 ms. 

4. Configure a static default route on CE2 to access the ISP device, with next-hop IP address as 195.2.2.1.
The static default route should be bound to an NQA ICMP test instance on the link
between CE2 and the ISP device. The test instance is performed once every 5s.  

------------------------

https://support.huawei.com/enterprise/en/doc/EDOC1100125525/4a0bbc75/example-for-configuring-hub-and-spoke-dual-links-between-a-hub-pe-and-a-hub-ce

https://support.huawei.com/enterprise/en/doc/EDOC1100125525/efef077f/example-for-configuring-an-mce
